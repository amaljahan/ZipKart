<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>Fruitables - Vegetable Website Template</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

        <!-- <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->
        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap" rel="stylesheet"> 

        <!-- Icon Font Stylesheet -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

        <!-- Libraries Stylesheet -->
        <link href="/css/lib/lightbox/css/lightbox.min.css" rel="stylesheet">
        <link href="/css/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>



        <!-- Customized Bootstrap Stylesheet -->
        <link href="/css/css/bootstrap.min.css" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="/css/css/style.css" rel="stylesheet">
        



        <style>
            
    
            .bg-primary {
                background-color: #2874f0 !important
            }

            .bg-secondary {
                background-color: #2874f0!important
            }
            .text-primary {
                color: #71a5fb !important;
            }

            .text-secondary {
                color: #0cc20a !important
            }

            .navbar .navbar-nav .nav-link:hover,
            .navbar .navbar-nav .nav-link.active,
            .fixed-top.bg-white .navbar .navbar-nav .nav-link:hover,
            .fixed-top.bg-white .navbar .navbar-nav .nav-link.active {
                color: #000000;
            }
            #starContainer .fa-star {
    cursor: pointer;
    transition: color 0.2s ease-in-out;
}

#starContainer .fa-star.text-primary {
    color: gold; /* Filled stars will appear gold */
}



        </style>
        
    </head>

    <body>

        <!-- Spinner Start -->
        <div id="spinner" class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50  d-flex align-items-center justify-content-center">
            <div class="spinner-grow text-primary" role="status"></div>
        </div>
        <!-- Spinner End -->


        <!-- Navbar start -->
        <div class="container-fluid fixed-top">
            <div class="container topbar bg-primary d-none d-lg-block">
                <div class="d-flex justify-content-between">
                    <div class="top-info ps-2">
                        <small class="me-3"><i class="fas fa-map-marker-alt me-2 text-secondary"></i> <a href="#" class="text-white">123 Street, New York</a></small>
                        <small class="me-3"><i class="fas fa-envelope me-2 text-secondary"></i><a href="#" class="text-white">Email@Example.com</a></small>
                    </div>
                    <div class="top-link pe-2">
                        <a href="#" class="text-white"><small class="text-white mx-2">Privacy Policy</small>/</a>
                        <a href="#" class="text-white"><small class="text-white mx-2">Terms of Use</small>/</a>
                        
                    </div>
                </div>
            </div>
            <div class="container px-0">
                <nav class="navbar navbar-light bg-white navbar-expand-xl">
                    <a href="/zipkart/user/home" class="navbar-brand"><h1 class="text-primary display-6">ZipKart</h1></a>
                    <button class="navbar-toggler py-2 px-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                        <span class="fa fa-bars text-primary"></span>
                    </button>
                    <div class="collapse navbar-collapse bg-white" id="navbarCollapse">
                        <div class="navbar-nav mx-auto">
                            <a href="/zipkart/user/home" class="nav-item nav-link">Home</a>
                            <a href="/zipkart/user/products-categorised-view" class="nav-item nav-link">Shop</a>
                            <a href="/zipkart/user/product-detailed" class="nav-item nav-link active">Shop Detail</a>
                            <div class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Pages</a>
                                <div class="dropdown-menu m-0 bg-secondary rounded-0">
                                    <a href="cart.html" class="dropdown-item">Cart</a>
                                    <a href="chackout.html" class="dropdown-item">Chackout</a>
                                    <a href="testimonial.html" class="dropdown-item">Testimonial</a>
                                    <a href="404.html" class="dropdown-item">404 Page</a>
                                </div>
                            </div>
                            <a href="contact.html" class="nav-item nav-link">Contact</a>
                        </div>
                        <div class="d-flex m-3 me-0">

                            <!-- =================== -->
                            <% if (session.user) { %>
                                <a href="/zipkart/user/logout" class="text-white">  
                                    <button class="logout">Logout</button>
                                </a>
                            <% } else { %>
                                <a href="/zipkart/user/login" class="text-white">  
                                    <button class="logout" style="background-color: yellow;color:black">Login</button>
                                </a>
                            <% } %>                         
                            <!-- =================== -->

                            <button class="btn-search btn border border-secondary btn-md-square rounded-circle bg-white me-4" data-bs-toggle="modal" data-bs-target="#searchModal"><i class="fas fa-search text-primary"></i></button>
                            <% if (session.user) { %>
                            <a href="/zipkart/user/<%= session.userId %>/cart" class="position-relative me-4 my-auto">
                                <i class="fa fa-shopping-bag fa-2x"></i>
                                <span class="position-absolute bg-secondary rounded-circle d-flex align-items-center justify-content-center text-dark px-1" style="top: -5px; left: 15px; height: 20px; min-width: 20px;">3</span>
                            </a>

                                <a href="/zipkart/user/user-profile/accountDetails/<%= session.userId %>" class="my-auto">
                                    <i class="fas fa-user fa-2x"></i>
                                </a>
                                <span><%= session.user %></span>
                                <% } %>   
                        </div>
                    </div>
                </nav>
            </div>
        </div>
        <!-- Navbar End -->


        <!-- Modal Search Start -->
        <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content rounded-0">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Search by keyword</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body d-flex align-items-center">
                        <div class="input-group w-75 mx-auto d-flex">
                            <input type="search" class="form-control p-3" placeholder="keywords" aria-describedby="search-icon-1">
                            <span id="search-icon-1" class="input-group-text p-3"><i class="fa fa-search"></i></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal Search End -->


        <!-- Single Page Header start -->
        <div class="container-fluid page-header py-5">
            <h1 class="text-center text-white display-6">Product Detail</h1>
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a href="/zipkart/user/home">Home</a></li>
                <li class="breadcrumb-item"><a href="/zipkart/user/products-categorised-view">Shop</a></li>
                <li class="breadcrumb-item active text-white">Product Detail</li>
            </ol>
        </div>
        <!-- Single Page Header End -->


        <!-- Single Product Start -->
        <div class="container-fluid py-5 mt-5">
            <div class="container py-5">
                <div class="row g-4 mb-5">
                    <div class="col-lg-8 col-xl-9"> 
                        <div class="row g-4">
                            <div class="col-lg-6">
                                <div class="image-container border rounded">
                                    <button id="previousBtn" class="btn-arrow left-arrow">
                                        <i class="fas fa-arrow-left"></i>
                                    </button>
                                
                                        <img   id="productImage<%= product._id %>" 
                                             src="<%= product.images[0].showcaseUrl %>" 
                                             class="img-fluid rounded zoom-trigger" 
                                             alt="Image" 
                                             data-images='<%= JSON.stringify(product.images) %>'>
                                    
                                    <button id="nextBtn" class="btn-arrow right-arrow">
                                        <i class="fas fa-arrow-right"></i>
                                    </button>
                                    <div id="selectionBox"></div>
                                </div>
                            </div>
                            
                            <style>
                            .image-container {
                                position: relative; /* Set relative positioning for child elements */
                                overflow: hidden;
                                width: 100%;
                                height: 100%;
                                cursor: grab;
                            }
                            
                            .zoom-trigger {
                                position: absolute;
                                top: 0;
                                left: 0;
                                width: 100%;
                                height: auto; /* Maintain aspect ratio */
                                transition: transform 0.2s ease-in-out;
                                cursor: grab;
                                will-change: transform, top, left;
                            }
                            
                            .btn-arrow {
                                position: absolute;
                                top: 50%; /* Vertically center */
                                transform: translateY(-50%);
                                background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
                                color: white;
                                border: none;
                                padding: 10px 15px;
                                z-index: 20; /* Ensure buttons are above the image */
                                cursor: pointer;
                            }
                            
                            .left-arrow {
                                left: 10px; /* Position on the left */
                            }
                            
                            .right-arrow {
                                right: 10px; /* Position on the right */
                            }
                            
                            #selectionBox {
                                position: absolute;
                                border: 2px dashed #007bff;
                                display: none;
                                pointer-events: none;
                                z-index: 10; /* Above the image but below buttons */
                            }
                            </style>
                            
                        
               

<!-- <script>document.addEventListener("DOMContentLoaded", () => {
    const zoomableImage = document.querySelector(".zoomable-image");
    const container = zoomableImage.parentElement;
    let scale = 1; // Initial scale
    let isDragging = false;
    let startX = 0, startY = 0; // Starting mouse position for dragging
    let translateX = 0, translateY = 0; // Image translation offsets
    let currentX = 0, currentY = 0; // Track the drag movement

    // Zoom functionality with wheel
    zoomableImage.addEventListener("wheel", (event) => {
        event.preventDefault();

        const rect = container.getBoundingClientRect();
        const mouseX = event.clientX - rect.left;
        const mouseY = event.clientY - rect.top;

        // Determine zoom direction and update scale
        const zoomDirection = event.deltaY > 0 ? -0.1 : 0.1;
        const newScale = Math.min(Math.max(1, scale + zoomDirection), 3); // Restrict scale between 1x and 3x

        // Adjust translate values to zoom into the cursor position
        translateX -= (mouseX - translateX) * (newScale - scale) / scale;
        translateY -= (mouseY - translateY) * (newScale - scale) / scale;

        scale = newScale;
        updateTransform();
    });

    // Drag functionality
    zoomableImage.addEventListener("mousedown", (event) => {
        isDragging = true;
        startX = event.clientX;
        startY = event.clientY;
        currentX = translateX;
        currentY = translateY;
        container.style.cursor = "grabbing";
    });

    document.addEventListener("mousemove", (event) => {
        if (!isDragging) return;

        const dx = event.clientX - startX;
        const dy = event.clientY - startY;

        translateX = currentX + dx;
        translateY = currentY + dy;

        updateTransform();
    });

    document.addEventListener("mouseup", () => {
        isDragging = false;
        container.style.cursor = "grab";
    });

    // Update image transform with zoom and drag
    function updateTransform() {
        const rect = container.getBoundingClientRect();

        // Calculate boundaries to prevent overflow
        const maxOffsetX = Math.max(0, (scale - 1) * rect.width / scale);
        const maxOffsetY = Math.max(0, (scale - 1) * rect.height / scale);

        translateX = Math.max(-maxOffsetX, Math.min(maxOffsetX, translateX));
        translateY = Math.max(-maxOffsetY, Math.min(maxOffsetY, translateY));

        // Apply transform for zoom and position
        zoomableImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
    }

    // Reset zoom and position on double click
    zoomableImage.addEventListener("dblclick", () => {
        scale = 1;
        translateX = 0;
        translateY = 0;
        updateTransform();
    });
});
</script> -->
                            
<script>
            // JavaScript for image zoom
            document.querySelectorAll('.zoom-trigger').forEach(function (img) {
            img.addEventListener('mouseover', function () {
                imageZoom(this); // Pass 'this' (current image) to imageZoom function
            });
        });
    
        function imageZoom(img) {
            img.addEventListener('mousemove', function (e) {
                var rect = img.getBoundingClientRect();
                var x = e.clientX - rect.left; // X position within the image
                var y = e.clientY - rect.top; // Y position within the image
    
                var percentX = (x / img.offsetWidth) * 50;
                var percentY = (y / img.offsetHeight) * 50;
    
                img.style.transformOrigin = percentX + '% ' + percentY + '%';
                img.style.transform = 'scale(2)';
            });
    
            img.addEventListener('mouseleave', function () {
                img.style.transform = 'scale(1)';
            });
        }

</script>
                            

                            <!-- -------------------------start-------------------------------------------------------------- -->
                            <div class="col-lg-6">
                                <h4 class="fw-bold mb-3"><%= product.name %></h4> <!-- Product Name -->
                                <p class="mb-3">Category: <%= product.category.name %></p> <!-- Category Name -->
                                <h5 class="text-danger text-decoration-line-through">100 ₹</h5>
                                <h5 class="fw-bold mb-3"><%= product.price %> ₹</h5> <!-- Product Price in Rupees -->
                                <% if (product.stock === 0) { %>
                                    <p style="color: red;">Out of Stock</p>
                                <% } else if (product.stock < 50) { %>
                                    <p style="color: red;">The Stock is going to finish, Hurry Up!</p>
                                <% } %>
                                
                                </p>
                                <!-- Star Rating (Assuming you have a rating field in your Product model) -->
                                <div class="d-flex mb-4">
                                    <% for (let i = 0; i < 5; i++) { %>
                                        <i class="fa fa-star <%= i < reviews.rating ? 'text-secondary' : '' %>"></i>
                                    <% } %>
                                </div>
                            
                                <p class="mb-4"><%= product.description %></p> <!-- Product Description -->
                            
                                <div class="input-group quantity mb-5" style="width: 100px;" data-product-id="<%= product._id %>">
                                    <div class="input-group-btn">
                                        <button class="btn btn-sm btn-minus rounded-circle bg-light border">
                                            <i class="fa fa-minus"></i>
                                        </button>
                                    </div>
                                    <input type="text" class="form-control form-control-sm text-center border-0 quantity-input" value="1">
                                    <div class="input-group-btn">
                                        <button class="btn btn-sm btn-plus rounded-circle bg-light border">
                                            <i class="fa fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <a href="javascript:void(0);" 
                                   class="btn border border-secondary rounded-pill px-4 py-2 mb-4 text-primary add-to-cart-btn" 
                                   data-user-id="<%= session.userId %>">
                                    <i class="fa fa-shopping-bag me-2 text-primary"></i> Add to cart
                                </a>



                                <script>
                                    document.addEventListener("DOMContentLoaded", () => {
                                        // Handle quantity change
                                        document.querySelectorAll(".quantity").forEach(quantityContainer => {
                                            const minusButton = quantityContainer.querySelector(".btn-minus");
                                            const plusButton = quantityContainer.querySelector(".btn-plus");
                                            const quantityInput = quantityContainer.querySelector(".quantity-input");
                                            const productId = quantityContainer.getAttribute("data-product-id");
                                
                                            console.log(quantityInput.value);
                                            

                                            
                                
                                            // Handle Add to Cart
                                            const addToCartBtn = document.querySelector(".add-to-cart-btn");
                                            addToCartBtn.addEventListener("click", async () => {
                                                const userId = addToCartBtn.getAttribute("data-user-id");
                                                const count = parseInt(quantityInput.value, 10) || 1;
                                               
                                               if(!userId){
                                                return alert("You must be logged in to perform this action.");

                                               }
                                                console.log(quantityInput.value);

                                               
                                                try {
                                                    const response = await axios.patch(`/zipkart/user/${userId}/cart/update-cart?productId=${productId}&count=${count}`);
                                                    if (response.status === 200) {
                                                       await alert("Cart updated successfully!")
                                                         window.location.reload()
                                                        
                                                    } else {
                                                        throw new Error("Failed to update cart.");
                                                    }
                                                } catch (error) {
                                                    console.error("Error updating cart:", error);
                                                    alert("Something went wrong. Please try again.");
                                                }
                                            });
                                        });
                                    });
                                </script>




                            </div>
                            <div class="col-lg-12">
                                <!-- <br><br> -->
                                <nav>
                                    
                                    <div class="nav nav-tabs mb-3">
                                        <button class="nav-link active border-white border-bottom-0" type="button" role="tab"
                                            id="nav-about-tab" data-bs-toggle="tab" data-bs-target="#nav-about"
                                            aria-controls="nav-about" aria-selected="true">Description</button>
                                        <button class="nav-link border-white border-bottom-0" type="button" role="tab"
                                            id="nav-mission-tab" data-bs-toggle="tab" data-bs-target="#nav-mission"
                                            aria-controls="nav-mission" aria-selected="false">Reviews</button>
                                    </div>
                                </nav>
                                <div class="tab-content mb-5">
                                    <div class="tab-pane active" id="nav-about" role="tabpanel" aria-labelledby="nav-about-tab">
                                        <p><%= product.description %> </p>
                                        <p>Sabertooth peacock flounder; chain pickerel hatchetfish, pencilfish snailfish filefish Antarctic 
                                            icefish goldeye aholehole trumpetfish pilot fish airbreathing catfish, electric ray sweeper.</p>
                                        <div class="px-2">
                                            <div class="row g-4">
                                                <div class="col-6">
                                                    <div class="row bg-light align-items-center text-center justify-content-center py-2">
                                                        <div class="col-6">
                                                            <p class="mb-0">Weight</p>
                                                        </div>
                                                        <div class="col-6">
                                                            <p class="mb-0">1 kg</p>
                                                        </div>
                                                    </div>
                                                    <div class="row text-center align-items-center justify-content-center py-2">
                                                        <div class="col-6">
                                                            <p class="mb-0">Country of Origin</p>
                                                        </div>
                                                        <div class="col-6">
                                                            <p class="mb-0">Agro Farm</p>
                                                        </div>
                                                    </div>
                                                    <div class="row bg-light text-center align-items-center justify-content-center py-2">
                                                        <div class="col-6">
                                                            <p class="mb-0">Quality</p>
                                                        </div>
                                                        <div class="col-6">
                                                            <p class="mb-0">Organic</p>
                                                        </div>
                                                    </div>
                                                    <div class="row text-center align-items-center justify-content-center py-2">
                                                        <div class="col-6">
                                                            <p class="mb-0">Сheck</p>
                                                        </div>
                                                        <div class="col-6">
                                                            <p class="mb-0">Healthy</p>
                                                        </div>
                                                    </div>
                                                    <div class="row bg-light text-center align-items-center justify-content-center py-2">
                                                        <div class="col-6">
                                                            <p class="mb-0">Available Stock</p>
                                                        </div>
                                                        <div class="col-6">
                                                            <p class="mb-0"><%= product.stock %> Kg</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="nav-mission" role="tabpanel" aria-labelledby="nav-mission-tab">
                                        <% if (reviews && reviews.length > 0) { %>
                                            <% reviews.forEach(review => { %>
                                                <div class="d-flex mb-4">
                                                    <img src="img/avatar.jpg" class="img-fluid rounded-circle p-3" style="width: 100px; height: 100px;" alt="Avatar">
                                                    <div>
                                                        <p class="mb-2" style="font-size: 14px;"><%= new Date(review.createdAt).toLocaleDateString() %></p>
                                                        <div class="d-flex justify-content-between">
                                                            <h5><%= review.user || 'Anonymous' %></h5>
                                                            <div class="d-flex mb-3">
                                                                <% for (let i = 1; i <= 5; i++) { %>
                                                                    <i class="fa fa-star <%= i <= review.star ? 'text-secondary' : '' %>"></i>
                                                                <% } %>
                                                            </div>
                                                        </div>
                                                        <p><%= review.description %></p>
                                                    </div>
                                                </div>
                                            <% }); %>
                                        <% } else { %>
                                            <p>No reviews yet. Be the first to leave a review!</p>
                                        <% } %>
                                    </div>
                                    <div class="tab-pane" id="nav-mission" role="tabpanel" aria-labelledby="nav-mission-tab">
                                        <div class="d-flex">
                                            <img src="img/avatar.jpg" class="img-fluid rounded-circle p-3" style="width: 100px; height: 100px;" alt="">
                                            
                                            <div class="">
                                                <p class="mb-2" style="font-size: 14px;">April 12, 2024</p>
                                                <div class="d-flex justify-content-between">
                                                    <h5>Jason Smith</h5>
                                                    <div class="d-flex mb-3">
                                                        <i class="fa fa-star text-secondary"></i>
                                                        <i class="fa fa-star text-secondary"></i>
                                                        <i class="fa fa-star text-secondary"></i>
                                                        <i class="fa fa-star text-secondary"></i>
                                                        <i class="fa fa-star"></i>
                                                    </div>
                                                </div>
                                                <p>The generated Lorem Ipsum is therefore always free from repetition injected humour, or non-characteristic 
                                                    words etc. Susp endisse ultricies nisi vel quam suscipit </p>
                                            </div>

                                        </div>
                                        <div class="d-flex">
                                            <img src="img/avatar.jpg" class="img-fluid rounded-circle p-3" style="width: 100px; height: 100px;" alt="">
                                            <div class="">
                                                <p class="mb-2" style="font-size: 14px;">April 12, 2024</p>
                                                   <div class="d-flex justify-content-between">
                                                    <h5>Sam Peters</h5>
                                                    <div class="d-flex mb-3">
                                                        <i class="fa fa-star text-secondary"></i>
                                                        <i class="fa fa-star text-secondary"></i>
                                                        <i class="fa fa-star text-secondary"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                    </div>
                                                </div>
                                                <p class="text-dark">The generated Lorem Ipsum is therefore always free from repetition injected humour, or non-characteristic 
                                                    words etc. Susp endisse ultricies nisi vel quam suscipit </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="nav-vision" role="tabpanel">
                                        <p class="text-dark">Tempor erat elitr rebum at clita. Diam dolor diam ipsum et tempor sit. Aliqu diam
                                            amet diam et eos labore. 3</p>
                                        <p class="mb-0">Diam dolor diam ipsum et tempor sit. Aliqu diam amet diam et eos labore.
                                            Clita erat ipsum et lorem et sit</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Include SweetAlert for notifications -->

<form id="reviewForm" action="submit-review" method="POST">
    <h4 class="mb-5 fw-bold">Leave a Review</h4>
    <div class="row g-4">
        <!-- Hidden field for Product ID -->
        <input type="hidden" name="productId" value="<%= product._id %>" />
        <input type="hidden" name="userId" value="<%= session.userId %>" />

        <!-- Review Text -->
        <div class="col-lg-12">
            <div class="border-bottom rounded my-4">
                <textarea name="review" id="reviewText" class="form-control border-0" cols="30" rows="8" 
                          placeholder="Your Review *" spellcheck="false" required></textarea>
            </div>
        </div>

        <!-- Star Rating -->
        <div class="col-lg-12">
            <div class="d-flex justify-content-between py-3">
                <div class="d-flex align-items-center">
                    <p class="mb-0 me-3">Please rate:</p>
                    <div class="d-flex align-items-center" id="starContainer" style="font-size: 24px;">
                        <!-- Hollow stars initially -->
                        <i class="fa fa-star text-muted star" data-value="1"></i>
                        <i class="fa fa-star text-muted star" data-value="2"></i>
                        <i class="fa fa-star text-muted star" data-value="3"></i>
                        <i class="fa fa-star text-muted star" data-value="4"></i>
                        <i class="fa fa-star text-muted star" data-value="5"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hidden Input for Star Rating -->
        <input type="hidden" id="ratingInput" name="rating" required value="0">

        <!-- Submit Button -->
        <div class="col-lg-12 text-end">
            <button type="submit" class="btn btn-primary rounded-pill px-4 py-3">Post Comment</button>
        </div>
    </div>
</form>

                        </div>
                    </div>
                    <div class="col-lg-4 col-xl-3">
                        <div class="row g-4 fruite">
                            <div class="col-lg-12">
                                <div class="input-group w-100 mx-auto d-flex mb-4">
                                    <input type="search" class="form-control p-3" placeholder="keywords" aria-describedby="search-icon-1">
                                    <span id="search-icon-1" class="input-group-text p-3"><i class="fa fa-search"></i></span>
                                </div>
                                <div class="mb-4">
                                    <h4>Categories</h4>
                                    <ul class="list-unstyled fruite-categorie">
                                        <% categories.forEach(category => { %>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a href="/zipkart/user/products-categorised-view?category=<%= category._id %>">
                                                    <i class="fas fa-apple-alt me-2"></i><%= category.name %>
                                                </a> 
                                                <span>(<%= category.productCount %>)</span>
                                            </div>
                                        <% }); %>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <h4 class="mb-4">Featured products</h4>
                                <div class="d-flex align-items-center justify-content-start">
                                    <div class="rounded" style="width: 100px; height: 100px;">
                                        <img src="img/featur-1.jpg" class="img-fluid rounded" alt="Image">
                                    </div>
                                    <div>
                                        <h6 class="mb-2">Big Banana</h6>
                                        <div class="d-flex mb-2">
                                            <i class="fa fa-star text-secondary"></i>
                                            <i class="fa fa-star text-secondary"></i>
                                            <i class="fa fa-star text-secondary"></i>
                                            <i class="fa fa-star text-secondary"></i>
                                            <i class="fa fa-star"></i>
                                        </div>
                                        <div class="d-flex mb-2">
                                            <h5 class="fw-bold me-2">2.99  ₹</h5>
                                            <h5 class="text-danger text-decoration-line-through">4.11 </h5>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-center my-4">
                                    <a href="#" class="btn border border-secondary px-4 py-3 rounded-pill text-primary w-100">Vew More</a>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="position-relative">
                                    <img src="img/banner-fruits.jpg" class="img-fluid w-100 rounded" alt="">
                                    <div class="position-absolute" style="top: 50%; right: 10px; transform: translateY(-50%);">
                                        <h3 class="text-secondary fw-bold">Fresh <br> Fruits <br> Banner</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <h1 class="fw-bold mb-0">Related products</h1>
                <div class="vesitable">
                    <div class="owl-carousel vegetable-carousel justify-content-center">
                        <% products.forEach(product => { %>
                        <div class="border border-primary rounded position-relative vesitable-item">
                            <div class="vesitable-img">
                                <a href="/zipkart/user/product-detailed/<%= product._id %>">
                                    <img src="<%= product.images[0].thumbnailUrl %>" class="img-fluid w-100 rounded-top" alt="">
                                </a>
                            </div>
                            <div class="text-white bg-primary px-3 py-1 rounded position-absolute" style="top: 10px; right: 10px;">Vegetable</div>
                            <div class="p-4 pb-0 rounded-bottom">
                                <h4><%= product.name %></h4>
                                <p><%= product.description %></p>

                                <% if (product.stock === 0) { %>
                                    <p style="color: red;">Out of Stock</p>
                                <% } else if (product.stock < 50) { %>
                                    <p style="color: red;">The Stock is going to finish, Hurry Up!</p>
                                <% } %>
                                <h5 class="text-danger text-decoration-line-through">100 ₹</h5>
                                
                                <div class="d-flex justify-content-between flex-lg-wrap">
                                    <p class="text-dark fs-5 fw-bold">₹<%= product.price.toFixed(2) %> / <%= product.unit %></p>
                                    <a href="/zipkart/user/<%= session.userId %>/cart" class="btn border border-secondary rounded-pill px-3 py-1 mb-4 text-primary"><i class="fa fa-shopping-bag me-2 text-primary"></i> Add to cart</a>
                                </div>
                            </div>
                        </div>
                        <% }); %>


                        
                    </div>
                </div>
            </div>
        </div>
        <!-- Single Product End -->
    

        <!-- Footer Start -->
        <div class="container-fluid bg-dark text-white-50 footer pt-5 mt-5">
            <div class="container py-5">
                <div class="pb-4 mb-4" style="border-bottom: 1px solid rgba(226, 175, 24, 0.5) ;">
                    <div class="row g-4">
                        <div class="col-lg-3">
                            <a href="#">
                                <h1 class="text-primary mb-0">Fruitables</h1>
                                <p class="text-secondary mb-0">Fresh products</p>
                            </a>
                        </div>
                        <div class="col-lg-6">
                            <div class="position-relative mx-auto">
                                <input class="form-control border-0 w-100 py-3 px-4 rounded-pill" type="text" placeholder="Your Email">
                                <button type="submit" class="btn btn-primary border-0 border-secondary py-3 px-4 position-absolute rounded-pill text-white" style="top: 0; right: 0;">Subscribe Now</button>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="d-flex justify-content-end pt-3">
                                <a class="btn  btn-outline-secondary me-2 btn-md-square rounded-circle" href=""><i class="fab fa-twitter"></i></a>
                                <a class="btn btn-outline-secondary me-2 btn-md-square rounded-circle" href=""><i class="fab fa-facebook-f"></i></a>
                                <a class="btn btn-outline-secondary me-2 btn-md-square rounded-circle" href=""><i class="fab fa-youtube"></i></a>
                                <a class="btn btn-outline-secondary btn-md-square rounded-circle" href=""><i class="fab fa-linkedin-in"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row g-5">
                    <div class="col-lg-3 col-md-6">
                        <div class="footer-item">
                            <h4 class="text-light mb-3">Why People Like us!</h4>
                            <p class="mb-4">typesetting, remaining essentially unchanged. It was 
                                popularised in the 1960s with the like Aldus PageMaker including of Lorem Ipsum.</p>
                            <a href="" class="btn border-secondary py-2 px-4 rounded-pill text-primary">Read More</a>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="d-flex flex-column text-start footer-item">
                            <h4 class="text-light mb-3">Shop Info</h4>
                            <a class="btn-link" href="">About Us</a>
                            <a class="btn-link" href="">Contact Us</a>
                            <a class="btn-link" href="">Privacy Policy</a>
                            <a class="btn-link" href="">Terms & Condition</a>
                            <a class="btn-link" href="">Return Policy</a>
                            <a class="btn-link" href="">FAQs & Help</a>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="d-flex flex-column text-start footer-item">
                            <h4 class="text-light mb-3">Account</h4>
                            <a class="btn-link" href="">My Account</a>
                            <a class="btn-link" href="">Shop details</a>
                            <a class="btn-link" href="">Shopping Cart</a>
                            <a class="btn-link" href="">Wishlist</a>
                            <a class="btn-link" href="">Order History</a>
                            <a class="btn-link" href="">International Orders</a>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="footer-item">
                            <h4 class="text-light mb-3">Contact</h4>
                            <p>Address: 1429 Netus Rd, NY 48247</p>
                            <p>Email: Example@gmail.com</p>
                            <p>Phone: +0123 4567 8910</p>
                            <p>Payment Accepted</p>
                            <img src="img/payment.png" class="img-fluid" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer End -->

        <!-- Copyright Start -->
        <div class="container-fluid copyright bg-dark py-4">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        <span class="text-light"><a href="#"><i class="fas fa-copyright text-light me-2"></i>Your Site Name</a>, All right reserved.</span>
                    </div>
                    <div class="col-md-6 my-auto text-center text-md-end text-white">
                        <!--/*** This template is free as long as you keep the below author’s credit link/attribution link/backlink. ***/-->
                        <!--/*** If you'd like to use the template without the below author’s credit link/attribution link/backlink, ***/-->
                        <!--/*** you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". ***/-->
                        Designed By <a class="border-bottom" href="https://htmlcodex.com">HTML Codex</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Copyright End -->



        <!-- Back to Top -->
        <a href="#" class="btn btn-primary border-3 border-primary rounded-circle back-to-top"><i class="fa fa-arrow-up"></i></a>   

        
    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/css/lib/easing/easing.min.js"></script>
    <script src="/css/lib/waypoints/waypoints.min.js"></script>
    <script src="/css/lib/lightbox/js/lightbox.min.js"></script>
    <script src="/css/lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="/css/js/main.js"></script>

    <script>
// Ensure the page is loaded before adding event listeners
window.addEventListener('DOMContentLoaded', (event) => {
    // Get the image element
    const imageElement = document.querySelector('img');
    const images = JSON.parse(imageElement.getAttribute('data-images')); // Parse the images data

    // Ensure we have images data
    if (images && images.length > 0) {
        // Attach event listeners to the left and right buttons
        document.getElementById('previousBtn').addEventListener('click', function() {
            previousImage(images, imageElement);
        });

        document.getElementById('nextBtn').addEventListener('click', function() {
            nextImage(images, imageElement);
        });
    }

    // Function to normalize the image URL (strip domain)
    function normalizeUrl(url) {
        const a = document.createElement('a');
        a.href = url;
        return a.pathname;  // Get only the pathname part of the URL (relative path)
    }

    // Function to change to the next image
    function nextImage(images, imageElement) {
        console.log('Next Button clicked for Image URL:', imageElement.src);

        // Normalize current image URL to compare with data-images
        const currentImageUrl = normalizeUrl(imageElement.src);

        // Find the current index of the image
        const currentIndex = images.findIndex(image => normalizeUrl(image.showcaseUrl) === currentImageUrl);

        if (currentIndex === -1) {
            console.error('Current image not found in the image array!');
            return;
        }

        // Get the next image index, looping if needed
        const nextIndex = (currentIndex + 1) % images.length;

        // Update the image's src and alt attributes
        imageElement.src = images[nextIndex].showcaseUrl;
        imageElement.alt = images[nextIndex].altText;

        console.log('Next Image URL:', imageElement.src);
    }

    // Function to change to the previous image
    function previousImage(images, imageElement) {
        console.log('Previous Button clicked for Image URL:', imageElement.src);

        // Normalize current image URL to compare with data-images
        const currentImageUrl = normalizeUrl(imageElement.src);

        // Find the current index of the image
        const currentIndex = images.findIndex(image => normalizeUrl(image.showcaseUrl) === currentImageUrl);

        if (currentIndex === -1) {
            console.error('Current image not found in the image array!');
            return;
        }

        // Get the previous image index, looping if needed
        const prevIndex = (currentIndex - 1 + images.length) % images.length;

        // Update the image's src and alt attributes
        imageElement.src = images[prevIndex].showcaseUrl;
        imageElement.alt = images[prevIndex].altText;

        console.log('Previous Image URL:', imageElement.src);
    }
});

    </script>
<!-- ================================================================================================   -->
 <script>
    document.addEventListener('DOMContentLoaded', function () {
    const stars = document.querySelectorAll('#starContainer .star');
    const ratingInput = document.getElementById('ratingInput');
    const reviewForm = document.getElementById('reviewForm');
    const reviewText = document.getElementById('reviewText');

    stars.forEach((star, index) => {
        star.addEventListener('mouseenter', () => {
            fillStars(index + 1);
        });

        star.addEventListener('mouseleave', () => {
            resetStars();
        });

        star.addEventListener('click', () => {
            ratingInput.value = index + 1; // Set the rating value in hidden input
        });
    });

    // Function to fill stars up to the hovered or clicked star
    function fillStars(count) {
        stars.forEach((star, idx) => {
            if (idx < count) {
                star.classList.add('text-primary');
                star.classList.remove('text-muted');
            } else {
                star.classList.add('text-muted');
                star.classList.remove('text-primary');
            }
        });
    }

    // Function to reset stars based on the saved rating
    function resetStars() {
        const rating = parseInt(ratingInput.value) || 0;
        fillStars(rating);
    }

    // Initialize the stars display based on current rating
    resetStars();
     // Form submission validation
     reviewForm.addEventListener('submit', function (e) {
        e.preventDefault(); // Prevent default submission

        const rating = parseInt(ratingInput.value);
        const review = reviewText.value.trim();

        if (!rating) {
            alert('Please select a star rating.')
          
            return;
        }

        if (!review) {
            alert('Please write a review.')
            
            return;
        }


        // Submit the form via fetch
        fetch(reviewForm.action, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({
        productId: reviewForm.querySelector('input[name="productId"]').value,
        review,
        rating,
    }),
    })
    .then((response) => {
        console.log(response); // Log response to check if it's valid JSON
        return response.json();
    })
    .then((data) => {
        if (data.success) {
            alert("Your review has been submitted.")
            
            
            reviewForm.reset();
            resetStars(); // Reset stars
        } else {
            throw new Error(data.message || 'Failed to submit the review.');
        }
    })
    .catch((error) => {
        alert( error.message || 'Something went wrong. Please try again later.')
       
    });

    });
});


 </script>
    <script src="/css/error500.js"></script>

</body>

</html>