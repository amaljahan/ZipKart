<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Users Management</title>
  <link rel="stylesheet" href="/css/admin/dashboard.css">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <!-- Customized Bootstrap Stylesheet -->
  <link href="/css/css/bootstrap.min.css" rel="stylesheet">

  <!-- Template Stylesheet -->
  <link href="/css/css/style.css" rel="stylesheet">

</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <h1><span class="brand">Zip</span>Kart</h1>
    </div>
    <nav class="menu">
      <ul>
        <li class="menu-item"><a href="/zipkart/admin/dashboard">Dashboard</a></li>
        <li class="menu-item active"><a href="/zipkart/admin/users/view-users">Users</a></li>
        <li class="menu-item"><a href="/zipkart/admin/categories/view-category">Categories</a></li>
        <li class="menu-item "><a href="/zipkart/admin/products/view-products">Products</a></li>
        <li class="menu-item"><a href="#">Orders</a></li>
        <li class="menu-item"><a href="#">Settings</a></li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="title">Users Management</div>
        <a href="/zipkart/admin/logout"><button class="logout">Logout</button></a>
      
    </header>

    <!-- Search Bar -->
    <div class="search-bar">
      <form action="/zipkart/admin/users/view-users/search-user" method="get">
           <input type="text" placeholder="Search users..." id="searchInput" name="searchInput">
            <button type="submit">Search</button>
    </form>
    <%if(message){%>
      <p style="color: red;"><%=message %></p>
    <%}%>
    </div>

    <!-- Users Table -->
    <section>
      <table>
        <thead>
          <tr>
            <th>Si.No</th>
            <th>Name</th>
            <th>Email</th>
            <th>Google User</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="usersTable">
          <% users.forEach((user, index) => { %>
            <tr>
              <td><%= index + 1 %></td> <!-- Serial Number -->
              <td><%= user.firstName + " " + user.lastName %></td> <!-- Full Name -->
              <td><%= user.email %></td> <!-- Email -->
              <td>
                <% if (user.googleId) { %>
                  Yes
                <% } else { %>
                  No
                <% } %>
              </td> <!-- Google User Status -->
              <td>
                <% if (user.isBlocked) { %>
                  Blocked
                <% } else { %>
                  Active
                <% } %>
              </td> <!-- Status -->
              <td>
                <% if (user.isBlocked) { %>
                  <button class="btn-unblock" onclick="toggleStatus('<%= user._id %>', false, 'Active', this)">Unblock</button>
                <% } else { %>
                  <button class="btn-block" onclick="toggleStatus('<%= user._id %>', true, 'Blocked', this)">Block</button>
                <% } %>
              </td>
              <!-- Actions -->
            </tr>
          <% }) %>
        </tbody>
      </table>
       <!-- //paginiation -->
       <div class="col-12">
        <div class="pagination d-flex justify-content-center mt-5">
          <% if (hasPrevPage) { %>
            <a href="?page=<%= currentPage - 1 %>&limit=<%= limit %>" class="rounded">&laquo;</a>
          <% } %>

          <% for (let i = 1; i <= totalPages; i++) { %>
            <a href="?page=<%= i %>&limit=<%= limit %>" class="rounded <%= currentPage === i ? 'active' : '' %>"><%= i %></a>
          <% } %>
          
          <% if (hasNextPage) { %>
            <a href="?page=<%= currentPage + 1 %>&limit=<%= limit %>" class="rounded">&raquo;</a>
          <% } %>
            <a href="#" class="rounded">&raquo;</a>
        </div>
    </div>
    </section>
    
    
    
  </main>

  <script>
    function toggleStatus(userId, isBlocked, newStatus, button) {
      const row = button.closest('tr');
      const statusCell = row.querySelector('td:nth-child(5)'); // Status cell

      axios.post('block-unblock', { userId, isBlocked })
        .then(response => {
          // Update button text and style dynamically
          if (response.data.success) {
            if (isBlocked) {
              statusCell.textContent = 'Blocked';
              button.textContent = 'Unblock';
              button.classList.remove('btn-block');
              button.classList.add('btn-unblock');
              button.setAttribute('onclick', `toggleStatus('${userId}', false, 'Active', this)`);
            } else {
              statusCell.textContent = 'Active';
              button.textContent = 'Block';
              button.classList.remove('btn-unblock');
              button.classList.add('btn-block');
              button.setAttribute('onclick', `toggleStatus('${userId}', true, 'Blocked', this)`);
            }
          } else {
            alert('Failed to update status');
          }
        })
        .catch(err => {
          console.error(err);
          alert('Error updating user status');
        });
    }
  </script>
  
  <!-- JavaScript -->
  <!-- 
  <script>
    // Function to toggle user status
    function toggleStatus(button, newStatus) {
      const row = button.closest('tr');
      const statusCell = row.querySelector('td:nth-child(4)'); // Status cell

      if (newStatus === 'Blocked') {
        statusCell.textContent = 'Blocked';
        button.textContent = 'Unblock';
        button.className = 'btn-unblock';
        button.onclick = () => toggleStatus(button, 'Active');
      } else {
        statusCell.textContent = 'Active';
        button.textContent = 'Block';
        button.className = 'btn-block';
        button.onclick = () => toggleStatus(button, 'Blocked');
      }
    }
  </script>  -->
</body>
</html>
 